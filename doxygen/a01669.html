<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Contiki-Inga 3.x: Clock library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Contiki-Inga 3.x
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Clock library<div class="ingroups"><a class="el" href="a01869.html">Contiki system</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>The clock library is the interface between Contiki and the platform specific clock functionality.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gae3ced0551b26c9b99cb45a86f34d100a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gae3ced0551b26c9b99cb45a86f34d100a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01669.html#gae3ced0551b26c9b99cb45a86f34d100a">CLOCK_SECOND</a></td></tr>
<tr class="memdesc:gae3ced0551b26c9b99cb45a86f34d100a"><td class="mdescLeft">&#160;</td><td class="mdescRight">A second, measured in system clock time. <br/></td></tr>
<tr class="separator:gae3ced0551b26c9b99cb45a86f34d100a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga78ab77b57cf2e00089f0a3a22508524c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01669.html#ga78ab77b57cf2e00089f0a3a22508524c">clock_init</a> (void)</td></tr>
<tr class="memdesc:ga78ab77b57cf2e00089f0a3a22508524c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the clock library.  <a href="#ga78ab77b57cf2e00089f0a3a22508524c">More...</a><br/></td></tr>
<tr class="separator:ga78ab77b57cf2e00089f0a3a22508524c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae5b7160f2e653725ba5e2024c3cb7bff"><td class="memItemLeft" align="right" valign="top"><a class="el" href="a01366.html#ace2c3395110fad22d5d766b6c2b324d1">CCIF</a> clock_time_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01669.html#gae5b7160f2e653725ba5e2024c3cb7bff">clock_time</a> (void)</td></tr>
<tr class="memdesc:gae5b7160f2e653725ba5e2024c3cb7bff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current clock time.  <a href="#gae5b7160f2e653725ba5e2024c3cb7bff">More...</a><br/></td></tr>
<tr class="separator:gae5b7160f2e653725ba5e2024c3cb7bff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga20a977b4c84576e47fec86463a5bb84f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="a01366.html#ace2c3395110fad22d5d766b6c2b324d1">CCIF</a> unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01669.html#ga20a977b4c84576e47fec86463a5bb84f">clock_seconds</a> (void)</td></tr>
<tr class="memdesc:ga20a977b4c84576e47fec86463a5bb84f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current value of the platform seconds.  <a href="#ga20a977b4c84576e47fec86463a5bb84f">More...</a><br/></td></tr>
<tr class="separator:ga20a977b4c84576e47fec86463a5bb84f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga06b67aefbb407a877fc4b9cc9e6b70a8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01669.html#ga06b67aefbb407a877fc4b9cc9e6b70a8">clock_set_seconds</a> (unsigned long sec)</td></tr>
<tr class="memdesc:ga06b67aefbb407a877fc4b9cc9e6b70a8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the value of the platform seconds.  <a href="#ga06b67aefbb407a877fc4b9cc9e6b70a8">More...</a><br/></td></tr>
<tr class="separator:ga06b67aefbb407a877fc4b9cc9e6b70a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga82ef3aca786cc000eeece4a7d036b238"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01669.html#ga82ef3aca786cc000eeece4a7d036b238">clock_wait</a> (clock_time_t t)</td></tr>
<tr class="memdesc:ga82ef3aca786cc000eeece4a7d036b238"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for a given number of ticks.  <a href="#ga82ef3aca786cc000eeece4a7d036b238">More...</a><br/></td></tr>
<tr class="separator:ga82ef3aca786cc000eeece4a7d036b238"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac0603df16193735b2cf4b70d54133356"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01669.html#gac0603df16193735b2cf4b70d54133356">clock_delay_usec</a> (uint16_t dt)</td></tr>
<tr class="memdesc:gac0603df16193735b2cf4b70d54133356"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delay a given number of microseconds.  <a href="#gac0603df16193735b2cf4b70d54133356">More...</a><br/></td></tr>
<tr class="separator:gac0603df16193735b2cf4b70d54133356"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae57f21c49f465372a8bf2ac3fbe03ba8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gae57f21c49f465372a8bf2ac3fbe03ba8"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01669.html#gae57f21c49f465372a8bf2ac3fbe03ba8">clock_fine_max</a> (void)</td></tr>
<tr class="memdesc:gae57f21c49f465372a8bf2ac3fbe03ba8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deprecated platform-specific routines. <br/></td></tr>
<tr class="separator:gae57f21c49f465372a8bf2ac3fbe03ba8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab39f034abde9b75800698e459e43c3db"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01669.html#gab39f034abde9b75800698e459e43c3db">clock_delay</a> (unsigned int delay)</td></tr>
<tr class="memdesc:gab39f034abde9b75800698e459e43c3db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delay the CPU for a multiple of TODO.  <a href="#gab39f034abde9b75800698e459e43c3db">More...</a><br/></td></tr>
<tr class="separator:gab39f034abde9b75800698e459e43c3db"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The clock library is the interface between Contiki and the platform specific clock functionality. </p>
<p>The clock library defines a macro, CLOCK_SECOND, to convert seconds into the tick resolution of the platform. Typically this is 1-10 milliseconds, e.g. 4*CLOCK_SECOND could be 512. A 16 bit counter would thus overflow every 1-10 minutes. Platforms use the tick interrupt to maintain a long term count of seconds since startup.</p>
<p>Platforms may also implement rtimers for greater time resolution and for real-time interrupts, These use a corresponding RTIMER_SECOND.</p>
<dl class="section note"><dt>Note</dt><dd>These timers do not necessarily have a common divisor or are phase locked. One may be crystal controlled and the other may not. Low power operation or sleep will often use one for wake and disable the other, then give it a tick correction after wakeup.</dd>
<dd>
The clock library need in many cases not be used directly. Rather, the <a class="el" href="a01681.html">timer library</a>, <a class="el" href="a01672.html">event timers</a>, or rtimer library should be used.</dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="a01681.html">Timer library</a> </dd>
<dd>
<a class="el" href="a01672.html">Event timers</a> </dd>
<dd>
<a class="el" href="a00084.html">Realtime library</a> </dd></dl>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gab39f034abde9b75800698e459e43c3db"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void clock_delay </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>i</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Delay the CPU for a multiple of TODO. </p>
<p>Delay the CPU for a multiple of TODO.</p>
<p>The original clock_delay for the msp430 used a granularity of 2.83 usec. This approximates that delay for values up to 1456 usec. (The largest core call in <a class="el" href="a00183_source.html">leds.c</a> uses 400). </p>

<p>Definition at line <a class="el" href="a00921_source.html#l00150">150</a> of file <a class="el" href="a00921_source.html">clock.c</a>.</p>

<p>References <a class="el" href="a00603_source.html#l00196">clock_delay_usec()</a>.</p>

<p>Referenced by <a class="el" href="a00183_source.html#l00075">leds_blink()</a>.</p>

</div>
</div>
<a class="anchor" id="gac0603df16193735b2cf4b70d54133356"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clock_delay_usec </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>len</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Delay a given number of microseconds. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dt</td><td>How many microseconds to delay.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Interrupts could increase the delay by a variable amount.</dd></dl>
<p>Delay a given number of microseconds.</p>
<p>Use the 250KHz MACA clock for longer delays to avoid interrupt effects. However that can't be used if the radio is being power cycled!</p>
<p>Delay a given number of microseconds.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">len</td><td>Delay <em>len</em> uSecs</td></tr>
  </table>
  </dd>
</dl>
<p>See <a class="el" href="a01669.html#ga78ab77b57cf2e00089f0a3a22508524c" title="Initialize the clock library.">clock_init()</a> for GPT0 Timer A's configuration </p>

<p>Definition at line <a class="el" href="a00603_source.html#l00196">196</a> of file <a class="el" href="a00603_source.html">clock.c.LOCAL.2341.c</a>.</p>

<p>References <a class="el" href="a01142_source.html#l00405">DISABLE_INTERRUPTS</a>, <a class="el" href="a00704_source.html#l00049">GPT_0_BASE</a>, <a class="el" href="a00704_source.html#l00061">GPTIMER_CTL</a>, <a class="el" href="a00704_source.html#l00149">GPTIMER_CTL_TAEN</a>, <a class="el" href="a00704_source.html#l00067">GPTIMER_TAILR</a>, and <a class="el" href="a00961_source.html#l00082">pic32_clock_get_system_clock()</a>.</p>

<p>Referenced by <a class="el" href="a00690_source.html#l00122">cc2430_rf_command()</a>, <a class="el" href="a00921_source.html#l00150">clock_delay()</a>, <a class="el" href="a00928_source.html#l00125">clock_delay_msec()</a>, and <a class="el" href="a01544_source.html#l00524">mrf24j40_init()</a>.</p>

</div>
</div>
<a class="anchor" id="ga78ab77b57cf2e00089f0a3a22508524c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clock_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the clock library. </p>
<p>Start the clock by enabling the timer comparison interrupts.</p>
<p>This function initializes the clock library and should be called from the <a class="el" href="a01799.html#ga840291bc02cba5474a4cb46a9b9566fe" title="Main routine for the cc2538dk platform.">main()</a> function of the system.</p>
<p>Initialize the clock library.</p>
<p>We initialise the SysTick to fire 128 interrupts per second, giving us a value of 128 for CLOCK_SECOND</p>
<p>We also initialise GPT0:Timer A, which is used by <a class="el" href="a01669.html#gac0603df16193735b2cf4b70d54133356" title="Delay a given number of microseconds.">clock_delay_usec()</a>. We use 16-bit range (individual), count-down, one-shot, no interrupts. The system clock is at 16MHz giving us 62.5 nano sec ticks for Timer A. Prescaled by 16 gives us a very convenient 1 tick per usec </p>
<p>set Timer/Counter0 to be asynchronous from the CPU clock with a second external clock(32,768kHz) driving it.</p>
<p>Wait for TCN0UB, OCR0UB, and TCR0UB.</p>

<p>Definition at line <a class="el" href="a00603_source.html#l00116">116</a> of file <a class="el" href="a00603_source.html">clock.c.LOCAL.2341.c</a>.</p>

<p>References <a class="el" href="a01142_source.html#l00459">ATOMIC</a>, <a class="el" href="a01200_source.html#l00200">BIT</a>, <a class="el" href="a00453_source.html#l00081">CLOCK_SECOND</a>, <a class="el" href="a00704_source.html#l00049">GPT_0_BASE</a>, <a class="el" href="a00704_source.html#l00058">GPTIMER_CFG</a>, <a class="el" href="a00704_source.html#l00061">GPTIMER_CTL</a>, <a class="el" href="a00704_source.html#l00059">GPTIMER_TAMR</a>, <a class="el" href="a00704_source.html#l00071">GPTIMER_TAPR</a>, <a class="el" href="a01200_source.html#l00186">NULL</a>, <a class="el" href="a00484_source.html#l00133">RTIMER_NOW</a>, <a class="el" href="a00483_source.html#l00068">rtimer_set()</a>, <a class="el" href="a00718_source.html#l00065">SYS_CTRL_RCGCGPT</a>, <a class="el" href="a00718_source.html#l00132">SYS_CTRL_RCGCGPT_GPT0</a>, <a class="el" href="a01070_source.html#l00040">SysTick_CLKSourceConfig()</a>, <a class="el" href="a01070_source.html#l00073">SysTick_CounterCmd()</a>, <a class="el" href="a01070_source.html#l00093">SysTick_ITConfig()</a>, and <a class="el" href="a01070_source.html#l00057">SysTick_SetReload()</a>.</p>

<p>Referenced by <a class="el" href="a01334_source.html#l00135">main()</a>.</p>

</div>
</div>
<a class="anchor" id="ga20a977b4c84576e47fec86463a5bb84f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long clock_seconds </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the current value of the platform seconds. </p>
<p>Return seconds, default is time since startup.</p>
<p>This could be the number of seconds since startup, or since a standard epoch.</p>
<dl class="section return"><dt>Returns</dt><dd>The value.</dd></dl>
<p>The comparison avoids the need to disable clock interrupts for an atomic read of the four-byte variable.</p>
<p>Get the current value of the platform seconds.</p>
<p>The comparison avoids the need to disable clock interrupts for an atomic read of the four-byte variable. </p>

<p>Definition at line <a class="el" href="a00603_source.html#l00144">144</a> of file <a class="el" href="a00603_source.html">clock.c.LOCAL.2341.c</a>.</p>

<p>References <a class="el" href="a01200_source.html#l00186">NULL</a>.</p>

<p>Referenced by <a class="el" href="a00485_source.html#l00156">stimer_elapsed()</a>, <a class="el" href="a00485_source.html#l00124">stimer_expired()</a>, <a class="el" href="a00485_source.html#l00140">stimer_remaining()</a>, <a class="el" href="a00485_source.html#l00107">stimer_restart()</a>, and <a class="el" href="a00485_source.html#l00067">stimer_set()</a>.</p>

</div>
</div>
<a class="anchor" id="ga06b67aefbb407a877fc4b9cc9e6b70a8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clock_set_seconds </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>sec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the value of the platform seconds. </p>
<p>Set seconds, e.g.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sec</td><td>The value to set.</td></tr>
  </table>
  </dd>
</dl>
<p>to a standard epoch for an absolute date/time.</p>
<p>Set the value of the platform seconds.</p>
<p>to a standard epoch for an absolute date/time. </p>

<p>Definition at line <a class="el" href="a00603_source.html#l00157">157</a> of file <a class="el" href="a00603_source.html">clock.c.LOCAL.2341.c</a>.</p>

</div>
</div>
<a class="anchor" id="gae5b7160f2e653725ba5e2024c3cb7bff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">clock_time_t clock_time </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the current clock time. </p>
<p>Return the tick counter.</p>
<p>This function returns the current system clock time.</p>
<dl class="section return"><dt>Returns</dt><dd>The current clock time, measured in system ticks.</dd></dl>
<p>When 16 bit it typically wraps every 10 minutes. The comparison avoids the need to disable clock interrupts for an atomic read of the multi-byte variable.</p>
<p>Get the current clock time.</p>
<p>When 16 bit it typically wraps every 10 minutes. The comparison avoids the need to disable clock interrupts for an atomic read of the multi-byte variable. </p>
<dl><dt><b>Examples: </b></dt><dd><a class="el" href="a00012.html#a1">example-rucb.c</a>, and <a class="el" href="a00015.html#a1">example-rudolph2.c</a>.</dd>
</dl>
<p>Definition at line <a class="el" href="a00603_source.html#l00129">129</a> of file <a class="el" href="a00603_source.html">clock.c.LOCAL.2341.c</a>.</p>

<p>References <a class="el" href="a01200_source.html#l00186">NULL</a>.</p>

<p>Referenced by <a class="el" href="a00603_source.html#l00166">clock_wait()</a>, <a class="el" href="a00489_source.html#l00124">timer_expired()</a>, <a class="el" href="a00489_source.html#l00145">timer_remaining()</a>, <a class="el" href="a00489_source.html#l00107">timer_restart()</a>, and <a class="el" href="a00489_source.html#l00064">timer_set()</a>.</p>

</div>
</div>
<a class="anchor" id="ga82ef3aca786cc000eeece4a7d036b238"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clock_wait </td>
          <td>(</td>
          <td class="paramtype">clock_time_t&#160;</td>
          <td class="paramname"><em>i</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for a given number of ticks. </p>
<p>Wait for a number of clock ticks.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>How many ticks. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00603_source.html#l00166">166</a> of file <a class="el" href="a00603_source.html">clock.c.LOCAL.2341.c</a>.</p>

<p>References <a class="el" href="a00603_source.html#l00129">clock_time()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Apr 24 2014 16:26:18 for Contiki-Inga 3.x by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
