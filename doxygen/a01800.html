<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Contiki-Inga 3.x: cc2538 Clock</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Contiki-Inga 3.x
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">cc2538 Clock<div class="ingroups"><a class="el" href="a01799.html">The cc2538 Development Kit platform</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Implementation of the clock module for the cc2538.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:a00933"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00933.html">clock.c</a></td></tr>
<tr class="memdesc:a00933"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clock driver implementation for the TI cc2538. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga78ab77b57cf2e00089f0a3a22508524c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01800.html#ga78ab77b57cf2e00089f0a3a22508524c">clock_init</a> (void)</td></tr>
<tr class="memdesc:ga78ab77b57cf2e00089f0a3a22508524c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Arch-specific implementation of clock_init for the cc2538.  <a href="#ga78ab77b57cf2e00089f0a3a22508524c">More...</a><br/></td></tr>
<tr class="separator:ga78ab77b57cf2e00089f0a3a22508524c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga50c22f9b9d60dd1f9e59b63a3a6676b1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="a01366.html#ace2c3395110fad22d5d766b6c2b324d1">CCIF</a> clock_time_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01800.html#ga50c22f9b9d60dd1f9e59b63a3a6676b1">clock_time</a> (void)</td></tr>
<tr class="memdesc:ga50c22f9b9d60dd1f9e59b63a3a6676b1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current clock time.  <a href="#ga50c22f9b9d60dd1f9e59b63a3a6676b1">More...</a><br/></td></tr>
<tr class="separator:ga50c22f9b9d60dd1f9e59b63a3a6676b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga06b67aefbb407a877fc4b9cc9e6b70a8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01800.html#ga06b67aefbb407a877fc4b9cc9e6b70a8">clock_set_seconds</a> (unsigned long sec)</td></tr>
<tr class="memdesc:ga06b67aefbb407a877fc4b9cc9e6b70a8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the value of the platform seconds.  <a href="#ga06b67aefbb407a877fc4b9cc9e6b70a8">More...</a><br/></td></tr>
<tr class="separator:ga06b67aefbb407a877fc4b9cc9e6b70a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8bbd5d5a773349139eee79d365af36ab"><td class="memItemLeft" align="right" valign="top"><a class="el" href="a01366.html#ace2c3395110fad22d5d766b6c2b324d1">CCIF</a> unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01800.html#ga8bbd5d5a773349139eee79d365af36ab">clock_seconds</a> (void)</td></tr>
<tr class="memdesc:ga8bbd5d5a773349139eee79d365af36ab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current value of the platform seconds.  <a href="#ga8bbd5d5a773349139eee79d365af36ab">More...</a><br/></td></tr>
<tr class="separator:ga8bbd5d5a773349139eee79d365af36ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac300f3d9032ec85ecc6350a0a0de5afe"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01800.html#gac300f3d9032ec85ecc6350a0a0de5afe">clock_wait</a> (clock_time_t i)</td></tr>
<tr class="memdesc:gac300f3d9032ec85ecc6350a0a0de5afe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for a given number of ticks.  <a href="#gac300f3d9032ec85ecc6350a0a0de5afe">More...</a><br/></td></tr>
<tr class="separator:gac300f3d9032ec85ecc6350a0a0de5afe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf4f1e51649bae814fba523fbb78b7c55"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01800.html#gaf4f1e51649bae814fba523fbb78b7c55">clock_delay_usec</a> (uint16_t len)</td></tr>
<tr class="memdesc:gaf4f1e51649bae814fba523fbb78b7c55"><td class="mdescLeft">&#160;</td><td class="mdescRight">Arch-specific implementation of clock_delay_usec for the cc2538.  <a href="#gaf4f1e51649bae814fba523fbb78b7c55">More...</a><br/></td></tr>
<tr class="separator:gaf4f1e51649bae814fba523fbb78b7c55"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf3e6545fa8f667795805b8f42e1e9a4f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01800.html#gaf3e6545fa8f667795805b8f42e1e9a4f">clock_delay</a> (unsigned int i)</td></tr>
<tr class="memdesc:gaf3e6545fa8f667795805b8f42e1e9a4f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Obsolete delay function but we implement it here since some code still uses it.  <a href="#gaf3e6545fa8f667795805b8f42e1e9a4f">More...</a><br/></td></tr>
<tr class="separator:gaf3e6545fa8f667795805b8f42e1e9a4f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga227ed2a30a2298cd1414b545bb03507c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01800.html#ga227ed2a30a2298cd1414b545bb03507c">clock_adjust</a> (clock_time_t ticks)</td></tr>
<tr class="memdesc:ga227ed2a30a2298cd1414b545bb03507c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adjust the clock by moving it forward by a number of ticks.  <a href="#ga227ed2a30a2298cd1414b545bb03507c">More...</a><br/></td></tr>
<tr class="separator:ga227ed2a30a2298cd1414b545bb03507c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabd65a6abf21722a26686787058985881"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01800.html#gabd65a6abf21722a26686787058985881">clock_isr</a> (void)</td></tr>
<tr class="memdesc:gabd65a6abf21722a26686787058985881"><td class="mdescLeft">&#160;</td><td class="mdescRight">The clock Interrupt Service Routine.  <a href="#gabd65a6abf21722a26686787058985881">More...</a><br/></td></tr>
<tr class="separator:gabd65a6abf21722a26686787058985881"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Implementation of the clock module for the cc2538. </p>
<p>To implement the clock functionality, we use the SysTick peripheral on the cortex-M3. We run the system clock at 16 MHz and we set the SysTick to give us 128 interrupts / sec </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga227ed2a30a2298cd1414b545bb03507c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clock_adjust </td>
          <td>(</td>
          <td class="paramtype">clock_time_t&#160;</td>
          <td class="paramname"><em>ticks</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adjust the clock by moving it forward by a number of ticks. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ticks</td><td>The number of ticks</td></tr>
  </table>
  </dd>
</dl>
<p>This function is useful when coming out of PM1/2, during which the system clock is stopped. We adjust the clock by moving it forward by a number of ticks equal to the deep sleep duration. We update the seconds counter if we have to and we also do some housekeeping so that the next second will increment when it is meant to.</p>
<dl class="section note"><dt>Note</dt><dd>This function is only meant to be used by <a class="el" href="a01804.html#ga4138a502282e17470a3e94c6c386fa26" title="Perform an &#39;Exit Deep Sleep&#39; sequence.">lpm_exit()</a>. Applications should really avoid calling this </dd></dl>

<p>Definition at line <a class="el" href="a00933_source.html#l00176">176</a> of file <a class="el" href="a00933_source.html">clock.c</a>.</p>

</div>
</div>
<a class="anchor" id="gaf3e6545fa8f667795805b8f42e1e9a4f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void clock_delay </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>i</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Obsolete delay function but we implement it here since some code still uses it. </p>
<p>Delay the CPU for a multiple of TODO. </p>

<p>Definition at line <a class="el" href="a00933_source.html#l00157">157</a> of file <a class="el" href="a00933_source.html">clock.c</a>.</p>

<p>References <a class="el" href="a00603_source.html#l00196">clock_delay_usec()</a>.</p>

</div>
</div>
<a class="anchor" id="gaf4f1e51649bae814fba523fbb78b7c55"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clock_delay_usec </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>len</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Arch-specific implementation of clock_delay_usec for the cc2538. </p>
<p>Delay a given number of microseconds.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">len</td><td>Delay <em>len</em> uSecs</td></tr>
  </table>
  </dd>
</dl>
<p>See <a class="el" href="a01669.html#ga78ab77b57cf2e00089f0a3a22508524c" title="Initialize the clock library.">clock_init()</a> for GPT0 Timer A's configuration </p>

<p>Definition at line <a class="el" href="a00933_source.html#l00143">143</a> of file <a class="el" href="a00933_source.html">clock.c</a>.</p>

<p>References <a class="el" href="a00704_source.html#l00049">GPT_0_BASE</a>, <a class="el" href="a00704_source.html#l00061">GPTIMER_CTL</a>, <a class="el" href="a00704_source.html#l00149">GPTIMER_CTL_TAEN</a>, and <a class="el" href="a00704_source.html#l00067">GPTIMER_TAILR</a>.</p>

<p>Referenced by <a class="el" href="a00690_source.html#l00122">cc2430_rf_command()</a>, <a class="el" href="a00921_source.html#l00150">clock_delay()</a>, <a class="el" href="a00928_source.html#l00125">clock_delay_msec()</a>, and <a class="el" href="a01544_source.html#l00524">mrf24j40_init()</a>.</p>

</div>
</div>
<a class="anchor" id="ga78ab77b57cf2e00089f0a3a22508524c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clock_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Arch-specific implementation of clock_init for the cc2538. </p>
<p>Initialize the clock library.</p>
<p>We initialise the SysTick to fire 128 interrupts per second, giving us a value of 128 for CLOCK_SECOND</p>
<p>We also initialise GPT0:Timer A, which is used by <a class="el" href="a01669.html#gac0603df16193735b2cf4b70d54133356" title="Delay a given number of microseconds.">clock_delay_usec()</a>. We use 16-bit range (individual), count-down, one-shot, no interrupts. The system clock is at 16MHz giving us 62.5 nano sec ticks for Timer A. Prescaled by 16 gives us a very convenient 1 tick per usec </p>

<p>Definition at line <a class="el" href="a00933_source.html#l00076">76</a> of file <a class="el" href="a00933_source.html">clock.c</a>.</p>

<p>References <a class="el" href="a00704_source.html#l00049">GPT_0_BASE</a>, <a class="el" href="a00704_source.html#l00058">GPTIMER_CFG</a>, <a class="el" href="a00704_source.html#l00061">GPTIMER_CTL</a>, <a class="el" href="a00704_source.html#l00059">GPTIMER_TAMR</a>, <a class="el" href="a00704_source.html#l00071">GPTIMER_TAPR</a>, <a class="el" href="a00718_source.html#l00065">SYS_CTRL_RCGCGPT</a>, and <a class="el" href="a00718_source.html#l00132">SYS_CTRL_RCGCGPT_GPT0</a>.</p>

</div>
</div>
<a class="anchor" id="gabd65a6abf21722a26686787058985881"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clock_isr </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The clock Interrupt Service Routine. </p>
<p>It polls the etimer process if an etimer has expired. It also updates the software clock tick and seconds counter since reset. </p>

<p>Definition at line <a class="el" href="a00933_source.html#l00208">208</a> of file <a class="el" href="a00933_source.html">clock.c</a>.</p>

<p>References <a class="el" href="a00453_source.html#l00081">CLOCK_SECOND</a>, <a class="el" href="a01142_source.html#l00405">DISABLE_INTERRUPTS</a>, <a class="el" href="a00461_source.html#l00229">etimer_next_expiration_time()</a>, <a class="el" href="a00461_source.html#l00223">etimer_pending()</a>, and <a class="el" href="a00461_source.html#l00145">etimer_request_poll()</a>.</p>

</div>
</div>
<a class="anchor" id="ga8bbd5d5a773349139eee79d365af36ab"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a01366.html#ace2c3395110fad22d5d766b6c2b324d1">CCIF</a> unsigned long clock_seconds </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the current value of the platform seconds. </p>
<p>Return seconds, default is time since startup.</p>
<p>This could be the number of seconds since startup, or since a standard epoch.</p>
<dl class="section return"><dt>Returns</dt><dd>The value.</dd></dl>
<p>The comparison avoids the need to disable clock interrupts for an atomic read of the four-byte variable.</p>
<p>Get the current value of the platform seconds.</p>
<p>The comparison avoids the need to disable clock interrupts for an atomic read of the four-byte variable. </p>

<p>Definition at line <a class="el" href="a00933_source.html#l00122">122</a> of file <a class="el" href="a00933_source.html">clock.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga06b67aefbb407a877fc4b9cc9e6b70a8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clock_set_seconds </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>sec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the value of the platform seconds. </p>
<p>Set seconds, e.g.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sec</td><td>The value to set.</td></tr>
  </table>
  </dd>
</dl>
<p>to a standard epoch for an absolute date/time.</p>
<p>Set the value of the platform seconds.</p>
<p>to a standard epoch for an absolute date/time. </p>

<p>Definition at line <a class="el" href="a00933_source.html#l00116">116</a> of file <a class="el" href="a00933_source.html">clock.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga50c22f9b9d60dd1f9e59b63a3a6676b1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a01366.html#ace2c3395110fad22d5d766b6c2b324d1">CCIF</a> clock_time_t clock_time </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the current clock time. </p>
<p>Return the tick counter.</p>
<p>This function returns the current system clock time.</p>
<dl class="section return"><dt>Returns</dt><dd>The current clock time, measured in system ticks.</dd></dl>
<p>When 16 bit it typically wraps every 10 minutes. The comparison avoids the need to disable clock interrupts for an atomic read of the multi-byte variable.</p>
<p>Get the current clock time.</p>
<p>When 16 bit it typically wraps every 10 minutes. The comparison avoids the need to disable clock interrupts for an atomic read of the multi-byte variable. </p>

<p>Definition at line <a class="el" href="a00933_source.html#l00110">110</a> of file <a class="el" href="a00933_source.html">clock.c</a>.</p>

</div>
</div>
<a class="anchor" id="gac300f3d9032ec85ecc6350a0a0de5afe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clock_wait </td>
          <td>(</td>
          <td class="paramtype">clock_time_t&#160;</td>
          <td class="paramname"><em>i</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for a given number of ticks. </p>
<p>Wait for a number of clock ticks.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>How many ticks. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00933_source.html#l00128">128</a> of file <a class="el" href="a00933_source.html">clock.c</a>.</p>

<p>References <a class="el" href="a00603_source.html#l00129">clock_time()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Apr 24 2014 16:26:19 for Contiki-Inga 3.x by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
